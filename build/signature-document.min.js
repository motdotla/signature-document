/*! signature-document.js - 0.0.1 - 2014-09-15 - scottmotte */
var MicroEvent=function(){};MicroEvent.prototype={bind:function(a,b){this._events=this._events||{},this._events[a]=this._events[a]||[],this._events[a].push(b)},unbind:function(a,b){this._events=this._events||{},a in this._events!=!1&&this._events[a].splice(this._events[a].indexOf(b),1)},trigger:function(a){if(this._events=this._events||{},a in this._events!=!1)for(var b=0;b<this._events[a].length;b++)this._events[a][b].apply(this,Array.prototype.slice.call(arguments,1))}},MicroEvent.mixin=function(a){for(var b=["bind","unbind","trigger"],c=0;c<b.length;c++)"function"==typeof a?a.prototype[b[c]]=MicroEvent.prototype[b[c]]:a[b[c]]=MicroEvent.prototype[b[c]]},"undefined"!=typeof module&&"exports"in module&&(module.exports=MicroEvent),function(a){var b=function(){return this.pages=[],this.uuid=this.Uuid(),this.script=this.CurrentlyExecutedScript(),this.parent=this.script.parentNode,this.json={documents:[]},this.width=1e3,this.height=1294,this.max_width=1e3,this.signature_document_url=this.script.getAttribute("data-signature-document-url"),this.style_width=this.calculateStyleWidth(),this.multiplier=this.calculateMultiplier(),this.style_height=this.calculateStyleHeight(),this.init(),this};b.prototype.init=function(){this.FireEvent("init",{}),this.script?(this.script.className+=" signature-document-script",this.script.id="signature-document-script-"+this.uuid,this._getDocument()):console.error("Could not find script tag to initialize on.")},b.prototype._getDocument=function(){var a=this;a._drawCss(),a._drawDocument(),a._drawPages(1),a.Get(a.signature_document_url,function(b){return a.json=b,a.page_count=a.json.documents[0].pages.length,a._drawPages(a.page_count),a._drawPagesBackgrounds(),a.FireEvent("rendered",{}),!0})},b.prototype.calculateStyleWidth=function(){var a=this.parent.clientWidth||this.parent.offsetWidth;return Math.min(a,this.max_width)},b.prototype.calculateMultiplier=function(){return this.style_width/this.width},b.prototype.calculateStyleHeight=function(){return this.height*this.multiplier},b.prototype._calcOffset=function(){for(var a=0;a<this.fabrics.length;a++)this.fabrics[a].calcOffset()},b.prototype._drawDocument=function(){return this.document=document.createElement("article"),this.document.className="signature-document",this.document.id="signature-document-"+this.uuid,this.InsertAfter(this.script,this.document)},b.prototype._drawPagesBackgrounds=function(){for(var a=0;a<this.pages.length;a++){var b=this.json.documents[0].pages[a];this.pages[a].style.backgroundImage="url("+b.url+")"}return!0},b.prototype._drawPages=function(a){for(var b=0;a>b;b++)this.pages.length<=b&&this._drawPage(b+1);return!0},b.prototype._drawPage=function(a){var b=document.createElement("section");return b.className="signature-page",b.id="signature-page-"+a,b.style.width=this.style_width,b.style.height=this.style_height,b.style.maxWidth=this.max_width,this.pages.push(b),this.document.appendChild(b)},b.prototype.Uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b,c;return b=16*Math.random()|0,c="x"===a?b:3&b|8,c.toString(16)})},b.prototype.CurrentlyExecutedScript=function(){var a;if(document){var b=document.getElementsByTagName("script");a=b[b.length-1]}return a},b.prototype.InsertAfter=function(a,b){return a.parentNode.insertBefore(b,a.nextSibling)},b.prototype.FireEvent=function(a,b){var c=this;setTimeout(function(){c.trigger(a,b)},50)},b.prototype.Get=function(a,b){var c=new XMLHttpRequest;c.open("GET",a,!0),c.setRequestHeader("Content-type","application/json"),c.onreadystatechange=function(){4==c.readyState&&200==c.status&&b(JSON.parse(c.responseText))},c.send()},b.prototype.getParam=function(a){return decodeURI((RegExp(a+"=(.+?)(&|$)").exec(location.search)||[,null])[1])},a.SignatureDocument=b}(this),function(a){a.prototype._drawCss=function(){this.css='@charset "utf-8";.signature-document{box-sizing:border-box;position:relative;margin:0;padding:55px 0 70px 0;border:0;font-size:100%;vertical-align:baseline;font-family:Helvetica;font-size:.8rem;text-align:center;background:rgba(0,0,0,0.1)}.signature-page{margin:0;padding:0;-webkit-tap-highlight-color:rgba(0,0,0,0);background:#fff;background:#fff url() center center no-repeat;background-size:contain;background-repeat:no-repeat;margin:0 auto;margin-bottom:10px;text-align:left}';var a=document.createElement("style");return a.type="text/css",a.styleSheet?a.styleSheet.cssText=this.css:a.appendChild(document.createTextNode(this.css)),document.body.appendChild(a)}}(SignatureDocument),MicroEvent.mixin(SignatureDocument);var signature_document=new SignatureDocument;